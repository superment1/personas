<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/sleep/" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link 
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Gelasio:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" 
      rel="stylesheet"  media="print" onload="this.media='all'">
    <meta name="theme-color" content="#fff">
    <link rel="icon" type="image/png" href="/public/favicon.webp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <!-- Analitics -->
    <script>
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({ 'gtm.start': Date.now(), event: 'gtm.js' });
      (function () {
        function loadGTM() {
          if (window.__gtmLoaded) return; window.__gtmLoaded = true;
          var s = document.createElement('script');
          s.async = true;
          s.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-T6Z2ZN9H';
          document.head.appendChild(s);
        }
        function loadHotjar() {
          if (window.__hjLoaded) return; window.__hjLoaded = true;
          (function (c, s, q, u, a, r, e) {
            c.hj = c.hj || function(){ (c.hj.q = c.hj.q || []).push(arguments) };
            c._hjSettings = { hjid: 6505028 }; // <-- use um ÃšNICO ID
            r = s.getElementsByTagName('head')[0];
            e = s.createElement('script'); e.async = true;
            e.src = q + c._hjSettings.hjid + u;
            r.appendChild(e);
          })(window, document, 'https://static.hj.contentsquare.net/c/csq-', '.js');
        }
        function loadAll(){ loadGTM(); loadHotjar(); cleanup(); }
        function cleanup(){
          window.removeEventListener('scroll', loadAll, { passive:true });
          window.removeEventListener('mousemove', loadAll);
          window.removeEventListener('touchstart', loadAll, { passive:true });
        }
        if ('requestIdleCallback' in window) requestIdleCallback(loadAll, { timeout: 3000 });
        else setTimeout(loadAll, 2000);

        window.addEventListener('scroll', loadAll, { passive:true });
        window.addEventListener('mousemove', loadAll);
        window.addEventListener('touchstart', loadAll, { passive:true });
      })();
    </script>
  </head>
  <body>
    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T6Z2ZN9H"
              height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <div id="app"></div>
    <div id="splash-hero"
        style="position:fixed;inset:0;z-index:9999;overflow:hidden;background:#E1DCCD;pointer-events:none">
      <picture style="position:absolute;inset:0">
    <source type="image/avif" srcset="/assets/posterMobile.avif 768w" sizes="100vw" media="(max-width:767px)">
    <source type="image/webp" srcset="/assets/posterMobile.webp 768w" sizes="100vw" media="(max-width:767px)">
    <img src="/assets/posterMobile.webp"
         alt="" width="768" height="820"
         loading="eager" decoding="async"
         style="position:absolute;top:0;width:100%;height:100%;object-fit:cover;object-position:top">
  </picture>
    </div>
    <script>
      new PerformanceObserver((list) => {
        for (const e of list.getEntries()) {
          console.log('[LCP]', Math.round(e.startTime), e.element?.tagName, e.element?.id || '');
        }
      }).observe({ type: 'largest-contentful-paint', buffered: true });
    </script>
    <script type="module" src="/src/main.js"></script>
    <script>
      (function () {
        const app = document.getElementById('app');
        const splash = document.getElementById('splash-hero');
        if (!app || !splash) return;

        const isMobile = matchMedia('(max-width: 767px)').matches;
        if (!isMobile) { app.style.opacity = '1'; splash?.remove(); return }
        const BASE = '/sleep';
        let rest = location.pathname.startsWith(BASE) ? location.pathname.slice(BASE.length) : location.pathname;
        rest = rest.split('?')[0].split('#')[0];  
        rest = rest.replace(/^\/+|\/+$/g, '');    
        const route = rest === '' ? 'supersleep' : rest.split('/')[0];
        const splashMap = {
          supersleep:   { avif: "assets/posterMobile.avif",       webp: "assets/posterMobile.webp" },
          beautysleep:  { avif: "assets/posterBeauty.avif",       webp: "assets/posterBeauty.webp" },
          vsl:          { avif: "assets/posterVsl.avif",          webp: "assets/posterVsl.webp" },
          vsl2:         { avif: "assets/posterVsl.avif",          webp: "assets/posterVsl.webp" },
          elderly:      { avif: "assets/posterElderly.avif",      webp: "assets/posterElderly.webp" },
          about:        { avif: "assets/posterAbout.avif",        webp: "assets/posterAbout.webp" },
          terms:        { avif: "assets/posterTerms.avif",        webp: "assets/posterTerms.webp" },
          faq:          { avif: "assets/posterFaq.avif",          webp: "assets/posterFaq.webp" },
          refundpolicy: { avif: "assets/posterRefundPolicy.avif", webp: "assets/posterRefundPolicy.webp" },
          privacypolicy:{ avif: "assets/posterPrivacyPolicy.avif",webp: "assets/posterPrivacyPolicy.webp" }, 
        };
        const assets = splashMap[route];
        if (!assets) { app.style.opacity = '1'; splash?.remove(); return }

        const sources = splash.querySelectorAll('source');
        const img = splash.querySelector('img');

        sources.forEach((s) => {
          const t = (s.getAttribute('type') || '').toLowerCase();
          if (t === 'image/avif') s.setAttribute('srcset', `${assets.avif} 768w`);
          if (t === 'image/webp') s.setAttribute('srcset', `${assets.webp} 768w`);
        });
        if (img) img.src = assets.webp;
        let done = false;
        const swap = () => {
          if (done) return; done = true;
          app.style.opacity = '1';
          requestAnimationFrame(() => splash?.remove());
          clearTimeout(fallback);
        };
        const obs = new MutationObserver(() => {
          if (app.hasAttribute('data-visual-ready')) { obs.disconnect(); swap(); }
        });
        obs.observe(app, { attributes: true });

        const fallback = setTimeout(swap, 3000);
      })();
    </script>

  </body>
  <style>
    #app { opacity: 0; transition: opacity 120ms ease; }
  </style>
</html>
