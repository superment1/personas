<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <base href="/sleep/" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link 
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Gelasio:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" 
      rel="stylesheet"  media="print" onload="this.media='all'">
    <link rel="preload" as="image" type="image/avif"
      href="/assets/hero-m-768.avif"
      imagesrcset="./assets/hero-m-768.avif 768w"
      imagesizes="100vw"
      media="(max-width: 767px)">
    <meta name="theme-color" content="#fff">
    <link rel="icon" type="image/png" href="/public/favicon.webp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <script>
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({ 'gtm.start': Date.now(), event: 'gtm.js' });
    </script>
    
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){ dataLayer.push(arguments); }
      gtag('consent','default',{
        ad_storage:'denied',
        analytics_storage:'denied',
        ad_user_data:'denied',
        ad_personalization:'denied',
        wait_for_update: 500
      });
    </script>
    <script>
      (function(){
        const loadGTM = () => {
          if (window.__gtmLoaded) return; window.__gtmLoaded = true;
          const s = document.createElement('script');
          s.async = true;
          s.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-T6Z2ZN9H';
          document.head.appendChild(s);
        };

        const onInteract = () => { loadGTM(); cleanup(); };
        const cleanup = () => {
          window.removeEventListener('scroll', onInteract, { passive:true });
          window.removeEventListener('mousemove', onInteract);
          window.removeEventListener('touchstart', onInteract, { passive:true });
        };

        // carrega no idle (até 3s) ou fallback em 2s; antes se houver interação
        if ('requestIdleCallback' in window) requestIdleCallback(loadGTM, { timeout: 3000 });
        else setTimeout(loadGTM, 2000);
        window.addEventListener('scroll', onInteract, { passive:true });
        window.addEventListener('mousemove', onInteract);
        window.addEventListener('touchstart', onInteract, { passive:true });
      })();
    </script>
  </head>
  <body>
    <div id="app" style="opacity:0;transition:opacity 120ms ease;background:#fff;"></div>

    <div id="splash-hero"
        style="position:fixed;inset:0;z-index:9999;overflow:hidden;background:#E1DCCD;pointer-events:none">
      <picture style="position:absolute;inset:0">
        <!-- AVIF preferido (mesmo arquivo do preload e do hero do app) -->
        <source type="image/avif"
                srcset="/assets/posterMobile.avif 768w"
                sizes="100vw"
                media="(max-width:767px)">
        <!-- WebP fallback -->
        <source type="image/webp"
                srcset="/assets/posterMobile.webp 768w"
                sizes="100vw"
                media="(max-width:767px)">
        <img src="/assets/posterMobile.avif"
            alt="" width="768" height="820"
            loading="eager" fetchpriority="high" decoding="async"
            style="position:absolute;top: 10px; width:100%;height:100%;object-fit:cover; object-position:center">
      </picture>
    </div>
    <script type="module" src="/src/main.js"></script>
    <script>
      (function () {
        const app = document.getElementById('app')
        const splash = document.getElementById('splash-hero')
        const isMobile = matchMedia('(max-width: 767px)').matches

        // Desktop: sem splash
        if (!isMobile) { app.style.opacity = '1'; splash?.remove(); return }

        let done = false
        const swap = () => {
          if (done) return; done = true
          app.style.opacity = '1'
          requestAnimationFrame(() => splash?.remove())
          clearTimeout(fallback)
        }

        // quando o app marcar "pronto visual"
        const obs = new MutationObserver(() => {
          if (app.hasAttribute('data-visual-ready')) { obs.disconnect(); swap() }
        })
        obs.observe(app, { attributes:true })

        // segurança: troca em 3s caso algo impeça o sinal
        const fallback = setTimeout(swap, 3000)
      })();
    </script>

  </body>
</html>
